<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Accessibility Issue Creator</title>

<link rel="stylesheet" href="css/superfish.css" media="screen">
<style>
#issue-create span {display: block;}
#download-controls {display: none;}
</style>

<script src="jquery.min.js"></script>
<script src="hoverIntent.js"></script>
<script src="superfish.min.js"></script>

<script src="debug.js"></script>
<script src="import.js"></script>
<script src="accessible-superfish.js"></script>
<script src="wcag-browser.js"></script>

</head>
<body>
<h1>Issues</h1>
<div id="status" role="region" aria-label="Status" aria-live="polite">
</div>

<nav>
<div>
<button id="new" accesskey="n">New Issue</button>
<button id="load" accesskey="l">Load Issues</button>
<button id="save" accesskey="s">Save Issues</button>
<span id="download-controls">
<label>Filename: <input type="text" class="fileName" value="issues.dat"></label>
<a class="download" href="#">Download</a>
<button class="cancel">Cancel</button>
</span>
</div><div>
<label>Select issue: <select id="issues"></select></label>
<button id="delete" accesskey="d">Delete</button>
</div>
</nav>

<main>

<div id="wcag-browser">
<h2>WCAG-2.0 Browser</h2>
<nav>
<label>Verbosity:
<select id="verbosity">
<option value="0">Principles</option>
<option value="1">Guidelines</option>
<option selected value="2">Criteria</option>
<option value="3">Off</option>
</select></label>

<div id="menu-container">
</div>
</nav>

<div id="text" aria-live="polite">
</div>
</div><!-- #wcag-browser -->

<hr>

<div id="issue-create" role="region">
<h2>Create Issue</h2>

<form>
<span class="issue">
<label>Title: <input type="text" data-name=" title"></label>
</span><span class="issue">
<label>Guideline: <input type="text" data-name="guideline"></label>
</span><span class="issue">
<label>Priority: <input type="range" data-name="priority" min="1" max="5"></label>
</span><span class="issue">
<label>Full description <textarea data-name="long-description"></textarea></label>
</span><span class="issue">
<label>Code example: <textarea data-name="code-example"></textarea></label>
</span>

<input class="create" type="submit" value="Submit">
</form>
</div>

<hr>

<div id="issues" role="region">
<h2>Issues</h2>
</div>

</main>

<div id="debug" aria-live="polite">
</div>


<script>
var issueNumber = 0;

var $headers = $('<tr></tr>')
.append (createTableHeaders ( $("#issue-create [data-name]")));
alert ($headers.html());

$("#issue-create").on ("submit", function (e) {
issueNumber += 1;

$(`<td>${issueNumber}</td>`)
.add (createIssue (getIssueData ( $("[data-name]", "#issue-create") )))
.appendTo ('<tr class="issue"></tr>')
.appendTo ($("#issues > table"));

return false;
}); // create

$("#save").on ("click", function (e) {
var url = createBlob (issueListData());
$("#download-controls .download").attr ("href", url);
$("#download-controls").show ()
.find (".fileName").focus ();

return false;
}); // save

$("#download-controls")
.on ("focusout", ".fileName", function (e) {
$("#download-controls .download").attr ("download", $(e.target).val());
return true;
}).on ("click", ".download", function (e) {
var fileName = $(e.target).attr ("download");

if (fileName) {
$("#download-controls").hide ();
return true;

} else {
statusMessage ("no file name given");
$("#download-controls .fileName").focus ();
return false;
} // if
}).on ("click", ".cancel", function (e) {
$("#save").focus ();
$("#download-controls").hide ();
}); // click .cancel

function issueListData () {
var issues = [];

$("#issues .issue").each (function () {
var issue = [];

$("[data-name]", this).each (function () {
issue.push ({
name: $(this).attr("data-name"),
value: $(this).text()
});
}); // each field

issues.push (issue);
}); // each issue

return issues;
} // issueListData

function createTableHeaders ($fields) {
alert (`fields: ${$fields.length}`);
var $headers = $fields.map (function (i, element) {
var name = $(element).attr ("data-name");
return $(`<th>${name}</th>`);
});

$headers = $('<th>Number</th>').add ($headers);
alert (`headers: ${$headers.length}`);
$headers = $('<tr></tr>').append ($headers);
statusMessage(`$headers: ${$headers.html()}`);
return $headers;
} // createTableHeaders


function createIssue (data) {
var $issue = $();

data.forEach (function (data) {
$issue = $issue.add ( $(`<td data-name="${data.name}">${data.value}</td>`) );
}); // forEach

alert ($issue.length);
return $issue;
} // createIssue
function getIssueData ($issue) {
var issueData = [];
alert (`getIssueData: ${$issue.length}`);

issueData = $issue.get().map (function (element) {
var name = $(element).attr ("data-name");
return {name: name, value: $(element).val()};
}); // map

alert (JSON.stringify(issueData));
return issueData;
} // getIssueData


function createBlob (object) {
var data = new Blob ([JSON.stringify(object)], {type: "application/json"});
return URL.createObjectURL(data);
} // createBlob

function statusMessage (message) {
$("#status").html("").text(message);
} // statusMessage

</script>

</body>
</html>
